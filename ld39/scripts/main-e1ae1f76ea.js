!function(){"use strict";function e(){var e=window.innerWidth,t=window.innerHeight;t*(9/16)<e?e=t*(9/16):t=e*(16/9),s=e/100,c.canvas.setAttribute("width",e),c.canvas.setAttribute("height",t),F.forEach(function(e){e&&e.set({x:c.canvas.width/2,y:c.canvas.height/2})}),u(),r&&(delete r.text,x())}function t(){createjs.Ticker.getPaused()||F.forEach(function(e){if(e.populationTimer+=1,e.populationTimer>n){e.population+=Math.pow(e.population,1.02)/1e3,e.populationTimer=0,e.demand=1e3*Math.pow(e.population/100,3);var t=2*(1-(e.power-e.demand)/a),i=(e.power-e.demand)/a*2;e.filters=[new createjs.ColorFilter(t,i,0,1)],e.uncache(),e.cache(-s,-s,2*s,2*s,e.power/1e3*l),u()}1===e.unit&&(e.unitText="W"),e.textPopulation.text="Population: "+parseInt(e.population,10),e.textDemand.text="Demand: "+e.demand.toFixed(1)+" "+e.unitText,e.textPower.text="Power: "+e.power+" "+e.unitText}),p()}var n=10,a=1e3,i=.5,o=.1,r=void 0,d=void 0,c=void 0,s=void 0,l=3,u=void 0,f=void 0,x=void 0,p=void 0,w=void 0,v=void 0,h=void 0,m=void 0,g=void 0,j=void 0,P=void 0,T=void 0,y=void 0,F=[];p=function(){r.text="FPS: "+createjs.Ticker.getMeasuredFPS().toFixed(1)},x=function(){r=c.addChild(new createjs.Text("FPS: "+createjs.Ticker.getMeasuredFPS().toFixed(1),"20px Arial","#ffffff")),r.textBaseline="alphabetic",r.x=10,r.y=c.canvas.height-(r.getMeasuredLineHeight()+5)},u=function(){d&&delete d.text;var e=!1;F.forEach(function(t){t.demand>t.power&&(e=!0)}),e&&(createjs.Ticker.setPaused(!0),d=c.addChild(new createjs.Text("YOU LOSE",15*s+"px Arial","#ffffff")),d.textBaseline="middle",d.textAlign="center",d.x=c.canvas.width/2,d.y=c.canvas.height/2,c.addEventListener("stagemousedown",f))},f=function(){createjs.Ticker.setPaused(!1),d&&delete d.text,c&&c.removeEventListener("stagemousedown",f),l=3,F.forEach(function(e){return v(e)})},h=function(e){var t=e.target;createjs.Ticker.getPaused()||(t.power+=100,g=createjs.Sound.play("sfx01"),g.volume=T),w(e.target)},w=function(e){createjs.Tween.removeAllTweens(e),createjs.Tween.get(e,{loop:!1}).to({scaleX:e.power/1e3*l,scaleY:e.power/1e3*l},200),e.uncache(),e.cache(-s,-s,2*s,2*s,e.power/1e3*l)},v=function(e){e.power=9e3,e.population=200,e.demand=1,e.populationTimer=10,e.unit=1,e.unitText="W",e.set({x:c.canvas.width/2,y:c.canvas.height/2,scaleX:e.power/1e3*l,scaleY:e.power/1e3*l})},y=function(){var e=new createjs.Shape;return e.graphics.beginFill("#ffffff").drawCircle(0,0,s),v(e),e.addEventListener("mousedown",h),e.filters=[new createjs.ColorFilter(0,1,0,1)],c.addChild(e),e.uncache(),e.cache(-s,-s,2*s,2*s,e.power/1e3*l),e.textPopulation=c.addChild(new createjs.Text("Population: "+e.population,6*s+"px Arial","#ffffff")),e.textPopulation.textBaseline="center",e.textPopulation.textAlign="center",e.textPopulation.x=e.x,e.textPopulation.y=e.y-(e.textPopulation.getMeasuredLineHeight()+5),e.textPopulation.shadow=new createjs.Shadow("#000000",0,0,.5*s),e.textDemand=c.addChild(new createjs.Text("Demand: "+e.demand,6*s+"px Arial","#ffffff")),e.textDemand.textBaseline="center",e.textDemand.textAlign="center",e.textDemand.x=e.x,e.textDemand.y=e.y,e.textDemand.shadow=new createjs.Shadow("#000000",0,0,.5*s),e.textPower=c.addChild(new createjs.Text("Power: "+e.power,6*s+"px Arial","#ffffff")),e.textPower.textBaseline="alphabetic",e.textPower.textAlign="center",e.textPower.x=e.x,e.textPower.y=e.y+(e.textPower.getMeasuredLineHeight()+5),e.textPower.shadow=new createjs.Shadow("#000000",0,0,.5*s),e},function(){c=new createjs.Stage("game"),createjs.Touch.enable(c),c.canvas.style.backgroundColor="#333",e(),F.push(y()),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.setFPS(60),createjs.Ticker.addEventListener("tick",c),createjs.Ticker.addEventListener("tick",t),x(),f(),P=i,T=o,createjs.Sound.registerSounds([{id:"bgm",src:"audio/bgm.mp3"},{id:"sfx01",src:"audio/sfx01.mp3"}]),createjs.Sound.addEventListener("fileload",function(){m=createjs.Sound.play("bgm"),m.loop=-1,m.volume=P}),j=!1;var n=c.addChild(new createjs.Text("",10*s+"px FontAwesome","#ffffff"));n.textBaseline="top",n.textAlign="left",n.x=c.canvas.width-12*s,n.y=2*s,n.addEventListener("mousedown",function(){j?(P=i,T=o,n.text="",n.color="#ffffff",j=!1):(P=0,T=0,n.text="",n.color="#666",j=!0),m&&(m.volume=P),g&&(g.volume=T)})}(),window.addEventListener("resize",function(){return e()});var S=document.getElementById("play");S.style.display="none",S.addEventListener("click",function(){createjs.Ticker.setPaused(!1),S.style.display="none",c.canvas.webkitRequestFullscreen?c.canvas.webkitRequestFullscreen():c.canvas.mozRequestFullScreen?c.canvas.mozRequestFullScreen():c.canvas.requestFullscreen&&c.canvas.requestFullscreen()})}();
